description: This sample provides list of the filesystem ids which use less than the supplised threshold

parameters:
  targets:
    type: TargetSpec
  threshold:
    type: String
    description: Upper bound for user storage per filesystem

steps:
  - task: powerstore::file_system_collection_query
    name: file_systems
    description: get all file systems
    targets: $targets

  - message: $threshold.to_bytes
  - message: $threshold.to_bytes.type
  - message: $file_systems[0].value['smb_test']['size_used']
  - message: $file_systems[0].value['smb_test']['size_used'].type
  - name: filtered_file_systems
    eval: $file_systems[0].value.filter |$k,$v| { $v['size_used'] != undef and $v['size_used'] < $threshold.to_bytes}

return: $filtered_file_systems.map |$k, $v| { $k, $v['size_used']).format_bytes }
